#!/usr/bin/env python3
# /// script
# dependencies = ["websockets"]
# ///
import asyncio as a
import websockets


async def rx(ws):
    async for message in ws:
        print(f"\n< {message}", flush=True)

async def tx(ws):
    while True:
        await ws.send(await a.to_thread(input, '> '))

async def term(ws):
    print(f"{ws.remote_address}")
    await a.gather(a.create_task(rx(ws)), a.create_task(tx(ws)))

async def main():
    async with websockets.serve(term, 'localhost', 8765):
        await a.Future()

a.run(main())
